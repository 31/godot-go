{{ $view := . -}}
package gdnative

/*------------------------------------------------------------------------------
//   This code was generated by template utilityfunctions.go.tmpl.
//
//   Changes to this file may cause incorrect behavior and will be lost if
//   the code is regenerated. Any updates should be done in
//   "globalenums.go.tmpl" so they can be included in the generated
//   code.
//----------------------------------------------------------------------------*/

//revive:disable

// #include <godot/gdnative_interface.h>
// #include "gdnative_wrapper.gen.h"
// #include <stdio.h>
// #include <stdlib.h>
import "C"
import "unsafe"

// utility functions
{{ range $i, $f := $view.UtilityFunctions -}}
{{ $fnReturnType := goReturnType $f.ReturnType }}
// {{ camelCase $f.Name }} is under the category "{{ $f.Category }}".
func {{ camelCase $f.Name }}(
{{- if $f.IsVararg -}}
	{{- range $j, $arg := $f.Arguments -}}
		{{ $arg.Name }} {{ goArgumentType $arg.Type }},
	{{- end -}}
{{- else -}}
	{{- range $j, $arg := $f.Arguments -}}
		{{ $arg.Name }} {{ goArgumentType $arg.Type }},
	{{- end -}}
{{- end -}}
) {{ $fnReturnType }} {
	{{/* TODO: refactor for static instantiation */}}
	cGdiPtr := (*C.GDNativeInterface)(internal.gdnInterface)
	cName := C.CString("{{ $f.Name }}")
	cHash := C.long({{ $f.Hash }})
	fn := C.cgo_GDNativeInterface_variant_get_ptr_utility_function(cGdiPtr, cName, cHash)
	C.free(unsafe.Pointer(cName))

	if fn == nil {
		panic("could not find utility function {{ $f.Name }} ({{ $f.Hash }})")
	}

	{{ if $fnReturnType -}}
	var ret {{ $fnReturnType }}
	retPtr := (C.GDNativeTypePtr)(unsafe.Pointer(&ret))
	{{- else -}}
	retPtr := (C.GDNativeTypePtr)(nullptr)
	{{- end }}

	sz := unsafe.Sizeof(nullptr) * uintptr({{ len $f.Arguments }})

	argBytes := unsafe.Pointer(C.malloc(C.size_t(sz)))

	{{ if $f.Arguments }}
	argsPtr := (*[{{ len $f.Arguments }}]unsafe.Pointer)(argBytes)

	{{ range $j, $arg := $f.Arguments -}}
		argsPtr[{{ $j }}] = unsafe.Pointer(&{{ $arg.Name }})
	{{ end }}
	{{ end }}

	args := (*C.GDNativeTypePtr)(argBytes)

	argCount := (C.int)({{ len $f.Arguments }})
	
	C.cgo_GDNativePtrUtilityFunction(fn, retPtr, args, argCount)

	{{ with $fnReturnType -}}
	C.free(argBytes)
	return ret
	{{- end }}
}
{{ end }}
